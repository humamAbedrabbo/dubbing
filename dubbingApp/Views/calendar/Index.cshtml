@{
    ViewBag.Title = "Calendar";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="jumbotron" style="padding:5px">
        <h2>Dubbing Calendar</h2>
        <p class="lead"><h5>Arrange Actors' Appointments to Perform the Planned Dubbing Schedules. Initially, Appointments are Generated by the Dubbing Schedular to Initiate CALLS with Actors and SET Appointments that optimize Resources. In addition, You Can Use this Calendar to Capture Attendance Data at the Arrival and Departure of Actors.</h5></p>
    </div>

    <div class="row">
        <div class="col-sm-3">
            <div class="col-sm-12">
                <small>
                    @Html.DropDownList("scheduleIntno", new SelectList(ViewBag.schedulesList, "Key", "Value"), "Select Schedule ...", htmlAttributes: new { @class = "form-control" })
                </small>
            </div>
            <br /><br />
            <div class="col-sm-12" id="actorsList"></div>    
        </div>
        
        <div class="col-sm-6" id="aptList"></div>
        <div class="col-sm-3" id="details"></div>
    </div>
</div>


@section Scripts
{
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/dubbing/busySpinner.js"></script>

    <script>
        //global ajax callback events handlers
        // to exclude specific ajax call write: "global: false," in the begining of ajax function
        $(document).ajaxStart(function () {
            ajaxIndicatorStart('loading data.. please wait..');
        }).ajaxComplete(function () {
            ajaxIndicatorStop();
        });

        $(document).ready(function () {
            $('#scheduleIntno').change(function () {
                $.ajax({
                    url: '@Url.Action("actorsList", "calendar")',
                    data: { schedule: $('#scheduleIntno').val() },
                    type: 'GET',
                    success: function (result) {
                        $('#actorsList').html(result);
                    }
                })
            });
        });

        function onActorClick(actor1, schedule1) {
            $('.actorLbl').removeClass('badge');
            $('#' + actor1).addClass('badge');

            $.ajax({
                url: '@Url.Action("appointmentsList", "calendar")',
                data: { actor: actor1, schedule: schedule1 },
                type: 'GET',
                success: function (result) {
                    $('#aptList').html(result);
                }
            })
        }

        function onCloseClick() {
            $('#details').html(null);
        }

        function onAppointmentUpdateClick(id) {
            $.ajax({
                url: '@Url.Action("appointmentUpdate", "calendar")',
                data: { apt: id },
                type: 'GET',
                success: function (result) {
                    $('#details').html(result);
                }
            })
        }
        function onAppointmentDeleteClick(id) {
            if (confirm('Please Confirm! About to Delete the Appointment.')) {
                $.ajax({
                    url: '@Url.Action("appointmentDelete", "calendar")',
                    data: { apt: id },
                    type: 'GET',
                    success: function (result) {
                        $('#details').html(null);
                        $('#aptList').html(result);
                    },
                    error: function () {
                        alert('Failed! Unable to Delete Appointment.');
                    }
                })
            }
        }
        function onAppointmentUpdateSuccess(ajaxContext) {
            $('#result').html('Successfully Updated.');
            $('#aptList').html(ajaxContext);
        }
        function onAppointmentUpdateFailure(ajaxContext) {
            if (ajaxContext !== null) {
                alert(ajaxContext.statusText);
            }
            else {
                alert('Failed! Unable to Update Appointment. Please Correct all Errors.');
            }
        }
        function onCalendarClick() {
            $.ajax({
                url: '@Url.Action("studioCalendarPopup", "calendar")',
                data: { std: $('#studioIntno').val() },
                type: 'GET',
                success: function (result) {
                    $('#calendarPopup').html(result);
                }
            })
        }
    </script>
}