@{
    ViewBag.Title = "Calendar";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="jumbotron" style="padding:5px">
        <h2>Dubbing Calendar</h2>
        <p class="lead"><h5>Arrange Actors' Appointments to Perform the Planned Dubbing Schedules. Initially, Appointments are Generated by the Dubbing Schedular to Initiate CALLS with Actors and SET Appointments that optimize Resources. In addition, You Can Use this Calendar to Capture Attendance Data at the Arrival and Departure of Actors.</h5></p>
    </div>

    <div class="row">
        <div class="col-sm-3">
            <div class="input-group" style="padding:0px">
                <small>
                    @Html.DropDownList("scheduleIntno", new SelectList(ViewBag.schedulesList, "Key", "Value"), "Select Schedule ...", htmlAttributes: new { @class = "form-control" })
                </small>
                <span class="input-group-btn">
                    <button type="button" class="btn btn-info" onclick="onCalendarViewClick()" title="Calendar View">
                        <span class="fa fa-calendar" aria-hidden="true"></span>
                    </button>
                </span>
            </div>
        </div>
        <div class="col-sm-9" id="supervisorsList"></div>
    </div>
    <hr />
    <div class="row">
        <div class="col-sm-3" id="actorsList"></div>    
        <div class="col-sm-6" id="aptList"></div>
        <div class="col-sm-3" style="padding:0px">
            <div id="worksList"></div>
            <div id="details"></div>
        </div>
        
    </div>
</div>


@section Scripts
{
    @Scripts.Render("~/bundles/jqueryval")

    <script>
        $(document).ready(function () {
            $('#scheduleIntno').change(function () {
                $.ajax({
                    url: '@Url.Action("actorsList", "calendar")',
                    data: { schedule: $('#scheduleIntno').val() },
                    type: 'GET',
                    success: function (result) {
                        $('#actorsList').html(result);
                    }
                });
                $.ajax({
                    url: '@Url.Action("supervisorsList", "calendar")',
                    data: { schedule: $('#scheduleIntno').val() },
                    type: 'GET',
                    success: function (result) {
                        $('#supervisorsList').html(result);
                    }
                });
                $.ajax({
                    url: '@Url.Action("workStudiosList", "calendar")',
                    data: { schedule: $('#scheduleIntno').val() },
                    type: 'GET',
                    success: function (result) {
                        $('#worksList').html(result);
                    }
                });
            });
        });

        function onCalendarViewClick()
        {
            if ($('#scheduleIntno').val() === '') {
                alert("Please Select Schedule.");
            }
            else {
                $.ajax({
                    url: '@Url.Action("getCalendar", "calendar")',
                    data: { schedule: $('#scheduleIntno').val() },
                    type: 'GET',
                    success: function (result) {
                        $('#aptList').removeClass('col-sm-6').addClass('col-sm-9');
                        $('#details').html(null);
                        $('#worksList').hide();
                        $('#aptList').html(result);
                    }
                })
            }
        }

        function onActorClick(actor1, actorName1, schedule1, menuId) {
            $('.actorLbl').removeClass("badge");
            $('#' + menuId).addClass("badge");
            $.ajax({
                url: '@Url.Action("appointmentsList", "calendar")',
                data: { actor: actor1, actorName: actorName1, schedule: schedule1 },
                type: 'GET',
                success: function (result) {
                    $('#aptList').removeClass('col-sm-9').addClass('col-sm-6');
                    $('#aptList').html(result);
                    $('#worksList').show();
                }
            })
        }

        function onCloseClick() {
            $('#details').html(null);
            $('#worksList').show();
        }

        function onAppointmentAddNewClick(id1) {
            $.ajax({
                url: '@Url.Action("appointmentAddNew", "calendar")',
                data: { id: id1 },
                type: 'GET',
                success: function (result) {
                    $('#aptList').html(result);
                }
            })
        }

        function onAppointmentUpdateClick(id) {
            $.ajax({
                url: '@Url.Action("appointmentUpdate", "calendar")',
                data: { apt: id },
                type: 'GET',
                success: function (result) {
                    $('#worksList').hide();
                    $('#details').html(result);
                }
            })
        }
        function onAppointmentDeleteClick(id) {
            if (confirm('Please Confirm! About to Delete the Appointment.')) {
                $.ajax({
                    url: '@Url.Action("appointmentDelete", "calendar")',
                    data: { apt: id },
                    type: 'GET',
                    success: function (result) {
                        $('#details').html(null);
                        $('#aptList').html(result);
                    },
                    error: function () {
                        alert('Failed! Unable to Delete Appointment.');
                    }
                })
            }
        }
        function onAppointmentUpdateSuccess(ajaxContext) {
            $('#result').html('Successfully Updated.');
            $('#aptList').html(ajaxContext);
        }
        function onAppointmentUpdateFailure(ajaxContext) {
            if (ajaxContext !== null) {
                alert(ajaxContext.statusText);
            }
            else {
                alert('Failed! Unable to Update Appointment. Please Correct all Errors.');
            }
        }
        function onCalendarClick() {
            $.ajax({
                url: '@Url.Action("studioCalendarPopup", "calendar")',
                data: { std: $('#studioIntno').val() },
                type: 'GET',
                success: function (result) {
                    $('#calendarPopup').html(result);
                }
            })
        }

        function onRemoveActorsClick(id1) {
            if (confirm("Please Confirm! About to Remove ALL Actor's Appointments from this Schedule")) {
                $.ajax({
                    url: '@Url.Action("actorAppointmentsDelete", "calendar")',
                    data: { id: id1 },
                    type: 'GET',
                    success: function (result) {
                        if ($.isEmptyObject(result)) {
                            $('#aptList').html(null);
                            $.ajax({
                                url: '@Url.Action("actorsList", "calendar")',
                                data: { schedule: $('#scheduleIntno').val() },
                                type: 'GET',
                                success: function (result1) {
                                    $('#actorsList').html(result1);
                                }
                            });
                        }
                        else {
                            $('#aptList').html(result);
                        }
                    }
                })
            }
        }
    </script>
}